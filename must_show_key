let txn = ctx.transaction

let input <- any(txn.reference_inputs)
let output = input.output

let asset <- any(flatten(output.value))
let (policy_id, _, _) = asset

and {
  policy_id == key_policy,
  txn.extra_signatories
    |> has(
      output.address.payment_credential
      |> unwrap_credential,
    ),
}
